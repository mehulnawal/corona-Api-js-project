<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corona Tracker Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <style>
        .stats-card {
            transition: transform 0.3s;
        }

        .stats-card:hover {
            transform: translateY(-5px);
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-4 md:mb-0">
                    <i class="fas fa-virus text-3xl mr-3"></i>
                    <h1 class="text-2xl font-bold">Corona Tracker Dashboard</h1>
                </div>
                <div class="flex items-center">
                    <div class="relative">
                        <input id="country-search"
                            class="bg-blue-700 text-white rounded-full pl-10 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-white"
                            type="text" placeholder="Search country...">
                        <i class="fas fa-search absolute left-3 top-3 text-blue-300"></i>
                    </div>
                    <button id="refresh-btn"
                        class="ml-4 bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-full flex items-center">
                        <i class="fas fa-sync-alt mr-2"></i> Refresh
                    </button>
                </div>
            </div>
            <div class="mt-4 text-sm">
                <span id="last-updated">Last updated: --</span>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-6">
        <!-- Loading indicator -->
        <div id="loader" class="loader"></div>

        <!-- Error message -->
        <div id="error-message"
            class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6" role="alert">
            <strong class="font-bold">Error!</strong>
            <span id="error-text" class="block sm:inline"> Unable to fetch data. Please try again later.</span>
        </div>

        <!-- Global Stats -->
        <section id="global-stats" class="hidden mb-8">
            <h2 class="text-xl font-bold mb-4">Global Statistics</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="stats-card bg-white p-6 rounded-lg shadow-md border-l-4 border-blue-500">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Total Cases</p>
                            <h3 id="global-cases" class="text-2xl font-bold">--</h3>
                        </div>
                        <div class="rounded-full bg-blue-100 p-2">
                            <i class="fas fa-globe text-blue-500"></i>
                        </div>
                    </div>
                    <p id="global-cases-today" class="mt-2 text-sm font-medium text-blue-500">+0 today</p>
                </div>

                <div class="stats-card bg-white p-6 rounded-lg shadow-md border-l-4 border-red-500">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Total Deaths</p>
                            <h3 id="global-deaths" class="text-2xl font-bold">--</h3>
                        </div>
                        <div class="rounded-full bg-red-100 p-2">
                            <i class="fas fa-heart-broken text-red-500"></i>
                        </div>
                    </div>
                    <p id="global-deaths-today" class="mt-2 text-sm font-medium text-red-500">+0 today</p>
                </div>

                <div class="stats-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-500">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Total Recovered</p>
                            <h3 id="global-recovered" class="text-2xl font-bold">--</h3>
                        </div>
                        <div class="rounded-full bg-green-100 p-2">
                            <i class="fas fa-heart text-green-500"></i>
                        </div>
                    </div>
                    <p class="mt-2 text-sm font-medium text-green-500">Recovery rate: <span
                            id="recovery-rate">--%</span></p>
                </div>

                <div class="stats-card bg-white p-6 rounded-lg shadow-md border-l-4 border-yellow-500">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Active Cases</p>
                            <h3 id="global-active" class="text-2xl font-bold">--</h3>
                        </div>
                        <div class="rounded-full bg-yellow-100 p-2">
                            <i class="fas fa-procedures text-yellow-500"></i>
                        </div>
                    </div>
                    <p class="mt-2 text-sm font-medium text-yellow-500">Active rate: <span id="active-rate">--%</span>
                    </p>
                </div>
            </div>
        </section>

        <!-- Data Visualization -->
        <section id="data-visualization" class="hidden mb-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-bold mb-4">Case Distribution</h3>
                <canvas id="distribution-chart" height="250"></canvas>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-bold mb-4">Top 10 Countries by Cases</h3>
                <canvas id="countries-chart" height="250"></canvas>
            </div>
        </section>

        <!-- Countries Table -->
        <section id="countries-section" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Countries Data</h2>
                <div class="flex">
                    <select id="sort-countries" class="bg-white border border-gray-300 rounded-md px-3 py-1 mr-2">
                        <option value="cases">Sort by Cases</option>
                        <option value="deaths">Sort by Deaths</option>
                        <option value="recovered">Sort by Recovered</option>
                        <option value="active">Sort by Active</option>
                    </select>
                    <button id="toggle-view" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-md">
                        <i class="fas fa-th-large"></i> <span>Card View</span>
                    </button>
                </div>
            </div>

            <!-- Table View -->
            <div id="table-view" class="bg-white rounded-lg shadow-md overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Country</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Total Cases</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                New Cases</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Total Deaths</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                New Deaths</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Total Recovered</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Active Cases</th>
                        </tr>
                    </thead>
                    <tbody id="countries-data" class="bg-white divide-y divide-gray-200">
                        <!-- Country data will be inserted here -->
                    </tbody>
                </table>
            </div>

            <!-- Card View (hidden by default) -->
            <div id="card-view" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                <!-- Country cards will be inserted here -->
            </div>
        </section>
    </main>

    <footer class="bg-blue-800 text-white mt-8">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p>© 2025 Corona Tracker Dashboard</p>
                    <p class="text-sm text-blue-300">Data provided by disease.sh API</p>
                </div>
                <div>
                    <p class="text-sm">Stay safe, wear a mask, and get vaccinated!</p>
                    <p class="text-sm mt-1">
                        <a href="#" class="text-blue-300 hover:text-white mr-4">About</a>
                        <a href="#" class="text-blue-300 hover:text-white mr-4">Resources</a>
                        <a href="#" class="text-blue-300 hover:text-white">Contact</a>
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Global variables
        let allCountriesData = [];
        let distributionChart = null;
        let countriesChart = null;

        // Format numbers with commas
        function formatNumber(num) {
            return num ? num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1,') : '0';
        }

        // Format date
        function formatDate(dateString) {
            const options = {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        // Show error message
        function showError(message) {
            document.getElementById('loader').classList.add('hidden');
            const errorElement = document.getElementById('error-message');
            document.getElementById('error-text').textContent = message;
            errorElement.classList.remove('hidden');
        }

        // Fetch global statistics
        async function fetchGlobalStats() {
            try {
                const response = await fetch('https://disease.sh/v3/covid-19/all');
                if (!response.ok) {
                    throw new Error('Failed to fetch global data');
                }
                const data = await response.json();

                // Update UI with global stats
                document.getElementById('global-cases').textContent = formatNumber(data.cases);
                document.getElementById('global-deaths').textContent = formatNumber(data.deaths);
                document.getElementById('global-recovered').textContent = formatNumber(data.recovered);
                document.getElementById('global-active').textContent = formatNumber(data.active);
                document.getElementById('global-cases-today').textContent = `+${formatNumber(data.todayCases)} today`;
                document.getElementById('global-deaths-today').textContent = `+${formatNumber(data.todayDeaths)} today`;

                // Calculate and update rates
                const recoveryRate = ((data.recovered / data.cases) * 100).toFixed(2);
                const activeRate = ((data.active / data.cases) * 100).toFixed(2);
                document.getElementById('recovery-rate').textContent = `${recoveryRate}%`;
                document.getElementById('active-rate').textContent = `${activeRate}%`;

                // Update last updated timestamp
                document.getElementById('last-updated').textContent = `Last updated: ${formatDate(data.updated)}`;

                // Show global stats section
                document.getElementById('global-stats').classList.remove('hidden');

                // Create distribution chart
                createDistributionChart(data);

                return data;
            } catch (error) {
                showError('Failed to fetch global statistics: ' + error.message);
                return null;
            }
        }

        // Fetch countries data
        async function fetchCountriesData() {
            try {
                const response = await fetch('https://disease.sh/v3/covid-19/countries?sort=cases');
                if (!response.ok) {
                    throw new Error('Failed to fetch countries data');
                }
                const data = await response.json();
                allCountriesData = data;

                // Render countries data
                renderCountriesData(data);

                // Create top countries chart
                createTopCountriesChart(data.slice(0, 10));

                // Show visualization and countries sections
                document.getElementById('data-visualization').classList.remove('hidden');
                document.getElementById('countries-section').classList.remove('hidden');
                document.getElementById('loader').classList.add('hidden');

                return data;
            } catch (error) {
                showError('Failed to fetch countries data: ' + error.message);
                return null;
            }
        }

        // Create distribution chart
        function createDistributionChart(data) {
            const ctx = document.getElementById('distribution-chart').getContext('2d');

            // Destroy existing chart if it exists
            if (distributionChart) {
                distributionChart.destroy();
            }

            distributionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Active', 'Recovered', 'Deaths'],
                    datasets: [{
                        data: [data.active, data.recovered, data.deaths],
                        backgroundColor: ['#FBBF24', '#10B981', '#EF4444'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const value = context.raw;
                                    const percentage = ((value / data.cases) * 100).toFixed(2);
                                    return `${context.label}: ${formatNumber(value)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Create top countries chart
        function createTopCountriesChart(topCountries) {
            const ctx = document.getElementById('countries-chart').getContext('2d');

            // Destroy existing chart if it exists
            if (countriesChart) {
                countriesChart.destroy();
            }

            const countryNames = topCountries.map(country => country.country);
            const countryCases = topCountries.map(country => country.cases);

            countriesChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: countryNames,
                    datasets: [{
                        label: 'Total Cases',
                        data: countryCases,
                        backgroundColor: '#3B82F6',
                        borderColor: '#2563EB',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `Cases: ${formatNumber(context.raw)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                callback: function (value) {
                                    return formatNumber(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        // Render countries data to table
        function renderCountriesData(countries) {
            const tableBody = document.getElementById('countries-data');
            const cardView = document.getElementById('card-view');

            // Clear existing data
            tableBody.innerHTML = '';
            cardView.innerHTML = '';

            countries.forEach(country => {
                // Table row
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <img class="h-6 w-6 rounded-full mr-2" src="${country.countryInfo.flag}" alt="${country.country} flag">
                            <div class="text-sm font-medium text-gray-900">${country.country}</div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatNumber(country.cases)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${country.todayCases > 0 ? 'text-blue-600 font-medium' : 'text-gray-500'}">
                        ${country.todayCases > 0 ? '+' + formatNumber(country.todayCases) : '0'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatNumber(country.deaths)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${country.todayDeaths > 0 ? 'text-red-600 font-medium' : 'text-gray-500'}">
                        ${country.todayDeaths > 0 ? '+' + formatNumber(country.todayDeaths) : '0'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatNumber(country.recovered)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatNumber(country.active)}</td>
                `;
                tableBody.appendChild(row);

                // Card
                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow-md overflow-hidden';
                card.innerHTML = `
                    <div class="p-4 border-b">
                        <div class="flex items-center">
                            <img class="h-8 w-8 rounded-full mr-2" src="${country.countryInfo.flag}" alt="${country.country} flag">
                            <h3 class="text-lg font-medium text-gray-900">${country.country}</h3>
                        </div>
                    </div>
                    <div class="p-4">
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <p class="text-xs text-gray-500">Total Cases</p>
                                <p class="text-sm font-medium">${formatNumber(country.cases)}</p>
                                <p class="text-xs ${country.todayCases > 0 ? 'text-blue-600' : 'text-gray-400'}">
                                    ${country.todayCases > 0 ? '+' + formatNumber(country.todayCases) : '+0'} today
                                </p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">Deaths</p>
                                <p class="text-sm font-medium">${formatNumber(country.deaths)}</p>
                                <p class="text-xs ${country.todayDeaths > 0 ? 'text-red-600' : 'text-gray-400'}">
                                    ${country.todayDeaths > 0 ? '+' + formatNumber(country.todayDeaths) : '+0'} today
                                </p>
                            </div>
                            <div class="mt-2">
                                <p class="text-xs text-gray-500">Recovered</p>
                                <p class="text-sm font-medium text-green-600">${formatNumber(country.recovered)}</p>
                            </div>
                            <div class="mt-2">
                                <p class="text-xs text-gray-500">Active</p>
                                <p class="text-sm font-medium text-yellow-600">${formatNumber(country.active)}</p>
                            </div>
                        </div>
                    </div>
                `;
                cardView.appendChild(card);
            });
        }

        // Search functionality
        function setupSearch() {
            const searchInput = document.getElementById('country-search');
            searchInput.addEventListener('input', function () {
                const searchTerm = this.value.toLowerCase();

                if (searchTerm.length === 0) {
                    renderCountriesData(allCountriesData);
                    return;
                }

                const filteredCountries = allCountriesData.filter(country =>
                    country.country.toLowerCase().includes(searchTerm)
                );

                renderCountriesData(filteredCountries);
            });
        }

        // Setup sorting
        function setupSorting() {
            const sortSelect = document.getElementById('sort-countries');
            sortSelect.addEventListener('change', function () {
                const sortBy = this.value;

                const sortedCountries = [...allCountriesData].sort((a, b) => b[sortBy] - a[sortBy]);
                renderCountriesData(sortedCountries);

                // Update top countries chart if the section is visible
                if (!document.getElementById('data-visualization').classList.contains('hidden')) {
                    createTopCountriesChart(sortedCountries.slice(0, 10));
                }
            });
        }

        // Toggle between table and card view
        function setupViewToggle() {
            const toggleButton = document.getElementById('toggle-view');
            const tableView = document.getElementById('table-view');
            const cardView = document.getElementById('card-view');

            toggleButton.addEventListener('click', function () {
                tableView.classList.toggle('hidden');
                cardView.classList.toggle('hidden');

                const buttonText = toggleButton.querySelector('span');
                const buttonIcon = toggleButton.querySelector('i');

                if (tableView.classList.contains('hidden')) {
                    buttonText.textContent = 'Table View';
                    buttonIcon.className = 'fas fa-table';
                } else {
                    buttonText.textContent = 'Card View';
                    buttonIcon.className = 'fas fa-th-large';
                }
            });
        }

        // Refresh data
        function setupRefresh() {
            const refreshButton = document.getElementById('refresh-btn');
            refreshButton.addEventListener('click', async function () {
                // Show loader and hide sections
                document.getElementById('loader').classList.remove('hidden');
                document.getElementById('global-stats').classList.add('hidden');
                document.getElementById('data-visualization').classList.add('hidden');
                document.getElementById('countries-section').classList.add('hidden');
                document.getElementById('error-message').classList.add('hidden');

                // Fetch data again
                await init();
            });
        }

        // Initialize the app
        async function init() {
            await fetchGlobalStats();
            await fetchCountriesData();
            setupSearch();
            setupSorting();
            setupViewToggle();
            setupRefresh();
        }

        // Start the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>